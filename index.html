<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专转 转 专拽爪转 -砖转砖</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playpen+Sans+Hebrew:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Playpen Sans Hebrew', cursive; /* Updated font-family */
            background-color: #f0f4f8;
            color: #333;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        #d3-container {
            width: 100%;
            height: 500px; /* Fixed height for the D3 graph */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem; /* Space below the graph */
        }
        .node circle {
            stroke: #fff;
            stroke-width: 1.5px;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            stroke-width: 2px;
        }
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 0.875rem;
            z-index: 100; /* Ensure tooltip is on top */
        }
        .progress-bar-container {
            background-color: #e2e8f0;
            border-radius: 0.5rem;
            height: 1.5rem;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        .progress-bar {
            height: 100%;
            border-radius: 0.5rem;
            text-align: center;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: width 0.5s ease-in-out;
        }
        .fairy-bg { background-color: #a78bfa; } /* Purple */
        .leprechaun-bg { background-color: #34d399; } /* Green */
        .dragon-bg { background-color: #f87171; } /* Red-orange */

        /* Styles for the line chart */
        .chart-container {
            width: 100%;
            height: 300px;
            margin-top: 2rem;
            background-color: #fdfdfd;
            border-radius: 0.75rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
            padding: 1rem;
            overflow: hidden; /* Ensure content stays within bounds */
        }
        .axis path,
        .axis line {
            fill: none;
            stroke: #cbd5e0;
            shape-rendering: crispEdges;
        }
        .axis text {
            font-size: 10px;
            fill: #64748b;
        }
        .line {
            fill: none;
            stroke: #f87171; /* Dragon color */
            stroke-width: 3px;
            transition: stroke-width 0.3s ease;
        }
        .line:hover {
            stroke-width: 5px;
        }
        .dot {
            fill: #f87171;
            stroke: #fff;
            stroke-width: 1.5px;
            transition: r 0.2s ease;
        }
        .dot:hover {
            r: 7px;
        }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <h1 class="text-4xl font-extrabold text-center mb-6 text-gray-800">专转 转 专拽爪转 -砖转砖</h1>

        <div id="d3-container">
            </div>

        <div class="card mt-8">
            <h2 class="text-2xl font-bold mb-4 text-gray-700">拽专</h2>
            <div class="flex flex-wrap justify-center gap-4 text-gray-700">
                <div class="flex items-center">
                    <div class="w-4 h-4 rounded-full bg-blue-500 mr-2"></div>
                    <span>砖转砖</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 rounded-full bg-purple-500 mr-2"></div>
                    <span>驻</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 rounded-full bg-green-500 mr-2"></div>
                    <span>驻专拽</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 rounded-full bg-red-500 mr-2"></div>
                    <span>专拽</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-1 bg-gray-400 mr-2"></div>
                    <span>专拽爪 转</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-1 bg-green-600 mr-2"></div>
                    <span>专拽爪 转/爪</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-1 bg-red-600 mr-2"></div>
                    <span>专拽爪 砖转/砖</span>
                </div>
            </div>
        </div>

        <div class="card mt-8">
            <h2 class="text-2xl font-bold mb-4 text-gray-700"> 转 专转</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-right">
                <div class="p-4 border border-gray-200 rounded-lg">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700">注转 住拽专 (驻)</h3>
                    <div class="flex items-center justify-end mb-2">
                        <div class="text-lg font-medium ml-2">50%</div>
                        <div class="w-full h-4 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full fairy-bg rounded-full" style="width: 50%;"></div>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600">转 4 砖转砖 砖拽 住拽专, 2  (, 专).</p>
                </div>

                <div class="p-4 border border-gray-200 rounded-lg">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700">砖转 驻专拽</h3>
                    <div class="mb-2">
                        <p class="text-sm font-medium text-gray-700 mb-1">砖转 砖砖专:</p>
                        <div class="w-full h-4 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full leprechaun-bg rounded-full" style="width: 50%;"></div>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">3 砖转 砖专 (, , 专).</p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-700 mb-1">砖转 砖:</p>
                        <div class="w-full h-4 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full dragon-bg rounded-full" style="width: 50%;"></div>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">3 砖转  (, 转).</p>
                    </div>
                </div>

                <div class="md:col-span-2 p-4 border border-gray-200 rounded-lg">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700">爪 专 专拽 注 爪专 </h3>
                    <div id="dragon-mood-chart" class="chart-container"></div>
                    <p class="text-sm text-gray-600 mt-2">专祝  爪 转 砖 爪 专 专拽 () 专  住. 爪专 驻拽 爪 转专 砖注, 爪专  爪 转  爪 专 .</p>
                </div>
            </div>
        </div>

        <div class="card mt-8">
            <h2 class="text-2xl font-bold mb-4 text-gray-700"> 住拽转 注拽专转 住</h2>
            <ul class="list-disc list-inside text-gray-700 space-y-2 text-right">
                <li>
                    <span class="font-semibold">驻爪  砖拽 砖专转:</span> 专注 砖 驻转 砖转 砖专转转 驻注转 转 拽转转 爪注转   爪 注专专 注.
                </li>
                <li>
                    <span class="font-semibold">砖转 拽专转 拽 转:</span> 砖 注拽专 注 住专 拽 注 (驻专 住注,  砖转砖, ).  砖 "专"  爪注 注 砖 驻注 拽砖转 转 .
                </li>
                <li>
                    <span class="font-semibold">爪专  转 砖转:</span>   转 住  注驻转 砖转砖 转 转 转拽砖专转 砖  注 转住.
                </li>
                <li>
                    <span class="font-semibold">  转驻拽 :</span>   (驻, 驻专拽, 专拽)  转驻拽  爪专 住 专拽爪 砖,  砖住祝 注砖专 .
                </li>
                <li>
                    <span class="font-semibold">注专转 拽转转:</span> 住 专  转 注 转砖转 拽转转 专转 砖转驻转 专   砖拽.
                </li>
            </ul>
            <p class="text-gray-600 mt-6">
                住 拽爪专 住驻拽 转转 砖转  驻爪 转专 砖砖  砖拽 砖转 拽转转.
                砖 驻转 爪专 转拽 砖驻专 拽, 转 砖转 转  砖 ,   专爪 拽 注 注专转  住注转.
            </p>
        </div>
    </div>

    <script>
        // Ensure D3 is loaded before executing D3-dependent code
        window.addEventListener('DOMContentLoaded', () => {
            // Define the data for the force-directed graph
            const nodesData = [
                { id: "", group: "user", details: "注专转  注 , 爪注 砖转, 砖 砖转." },
                { id: "专", group: "user", details: "注转 专砖转 住拽专." },
                { id: "专转", group: "user", details: "拽 住拽专." },
                { id: "转", group: "user", details: "专拽爪转 专转 注 驻专拽 (注转 , ')." },
                { id: "", group: "user", details: "爪注 砖 爪." },
                { id: "注", group: "user", details: "拽 住拽专 爪注转 砖." },
                { id: "驻", group: "bot", details: " 住拽专. 注转  住拽专." },
                { id: "驻专拽", group: "bot", details: " 砖转. 爪转 爪 转专 拽." },
                { id: "专拽", group: "bot", details: " 爪 专 拽转. 注专专 砖 专砖." }
            ];

            const linksData = [
                // Fairy interactions
                { source: "驻", target: "", type: "positive", description: "注转 住拽专" },
                { source: "驻", target: "专", type: "positive", description: "注转 住拽专" },
                { source: "驻", target: "注", type: "neutral", description: "砖转 住拽专" },
                { source: "驻", target: "专转", type: "neutral", description: "砖转 住拽专" },

                // Leprechaun interactions
                { source: "驻专拽", target: "", type: "positive", description: "砖专 爪注 砖" },
                { source: "驻专拽", target: "", type: "negative", description: "转 砖 (专  专)" },
                { source: "驻专拽", target: "转", type: "negative", description: "住专 砖 (注转 )" },
                { source: "驻专拽", target: "转", type: "negative", description: "转转 注 ' " },
                { source: "驻专拽", target: "", type: "positive", description: "砖专 爪注 砖" },
                { source: "驻专拽", target: "注", type: "neutral", description: "爪注转 砖" },

                // Dragon interactions
                { source: "专拽", target: "", type: "positive", description: "砖 注 爪 专拽" },
                { source: "专拽", target: "转", type: "positive", description: "砖 注 爪 专拽, 砖 驻" },

                // Bot relationships (conceptual)
                { source: "驻专拽", target: "专拽", type: "neutral", description: "砖转 驻专拽 砖驻注转 注 专拽" },
                { source: "驻", target: "专拽", type: "neutral", description: "住拽专 驻 砖驻注 注 专拽" }
            ];

            // Set up the SVG container for force-directed graph
            const svgContainer = document.getElementById('d3-container');
            const svgWidth = svgContainer.clientWidth;
            const svgHeight = svgContainer.clientHeight;

            const svg = d3.select("#d3-container").append("svg")
                .attr("width", "100%")
                .attr("height", "100%")
                .attr("viewBox", `0 0 ${svgWidth} ${svgHeight}`)
                .attr("preserveAspectRatio", "xMidYMid meet");

            // Create a tooltip div
            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip");

            // Define colors for groups
            const colorScale = d3.scaleOrdinal()
                .domain(["user", "bot"])
                .range(["#3b82f6", "#8b5cf6"]); // Blue for users, Purple for bots

            const botColorScale = d3.scaleOrdinal()
                .domain(["驻", "驻专拽", "专拽"])
                .range(["#a78bfa", "#34d399", "#f87171"]); // Purple for Fairy, Green for Leprechaun, Red-orange for Dragon

            const linkColorScale = d3.scaleOrdinal()
                .domain(["positive", "negative", "neutral"])
                .range(["#10b981", "#ef4444", "#9ca3af"]); // Green for positive, Red for negative, Gray for neutral

            // Create the force simulation
            const simulation = d3.forceSimulation(nodesData)
                .force("link", d3.forceLink(linksData).id(d => d.id).distance(100))
                .force("charge", d3.forceManyBody().strength(-300))
                .force("center", d3.forceCenter(svgWidth / 2, svgHeight / 2))
                .force("collide", d3.forceCollide(30)); // Prevent nodes from overlapping

            // Create links
            const link = svg.append("g")
                .attr("class", "links")
                .selectAll("line")
                .data(linksData)
                .join("line")
                .attr("class", "link")
                .attr("stroke", d => linkColorScale(d.type));

            // Create nodes
            const node = svg.append("g")
                .attr("class", "nodes")
                .selectAll("g")
                .data(nodesData)
                .join("g")
                .attr("class", "node")
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));

            node.append("circle")
                .attr("r", 20)
                .attr("fill", d => d.group === "bot" ? botColorScale(d.id) : colorScale(d.group));

            node.append("text")
                .attr("dx", 0)
                .attr("dy", 35)
                .attr("text-anchor", "middle")
                .attr("font-size", "12px")
                .attr("fill", "#333")
                .text(d => d.id);

            // Add hover effects for nodes
            node.on("mouseover", function(event, d) {
                tooltip.html(`<strong>${d.id}</strong><br>${d.details}`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px")
                    .style("opacity", 1);
            })
            .on("mouseout", function() {
                tooltip.style("opacity", 0);
            });

            // Update positions on each tick
            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node
                    .attr("transform", d => `translate(${d.x},${d.y})`);
            });

            // Drag functions
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }

            // Handle window resize for force-directed graph
            window.addEventListener('resize', () => {
                const newWidth = svgContainer.clientWidth;
                const newHeight = svgContainer.clientHeight;
                svg.attr("viewBox", `0 0 ${newWidth} ${newHeight}`);
                simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2));
                simulation.alpha(0.3).restart();

                // Also redraw the line chart on resize
                drawDragonMoodChart();
            });

            // Dragon Mood Line Chart Data
            const dragonMoodData = [
                { date: new Date("2025-06-28T00:16:01"), mood: 50 },
                { date: new Date("2025-06-28T01:10:13"), mood: 55 },
                { date: new Date("2025-06-28T15:25:55"), mood: 50 },
                { date: new Date("2025-06-28T21:46:33"), mood: 50 },
                { date: new Date("2025-06-29T07:46:10"), mood: 51 },
                { date: new Date("2025-06-29T20:15:17"), mood: 54 },
                { date: new Date("2025-06-29T20:17:19"), mood: 54 },
                { date: new Date("2025-06-30T11:08:42"), mood: 52 }
            ];

            function drawDragonMoodChart() {
                const chartDiv = document.getElementById('dragon-mood-chart');
                chartDiv.innerHTML = ''; // Clear previous chart on redraw

                const margin = { top: 20, right: 30, bottom: 60, left: 40 }; // Increased bottom margin for labels
                const width = chartDiv.clientWidth - margin.left - margin.right;
                const height = chartDiv.clientHeight - margin.top - margin.bottom;

                const chartSvg = d3.select("#dragon-mood-chart").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                // X scale (time)
                const xScale = d3.scaleTime()
                    .domain(d3.extent(dragonMoodData, d => d.date))
                    .range([0, width]);

                // Y scale (mood percentage)
                const yScale = d3.scaleLinear()
                    .domain([0, 100]) // Mood from 0% to 100%
                    .range([height, 0]);

                // X axis
                chartSvg.append("g")
                    .attr("class", "axis x-axis")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(xScale)
                        .ticks(d3.timeDay.every(1)) // Show ticks for each day
                        .tickFormat(d3.timeFormat("%b %d")) // Format: Jun 28
                    )
                    .selectAll("text")
                    .attr("transform", "rotate(-45)")
                    .style("text-anchor", "end");

                // Y axis
                chartSvg.append("g")
                    .attr("class", "axis y-axis")
                    .call(d3.axisLeft(yScale).ticks(5).tickFormat(d => d + "%"));

                // Add Y axis label
                chartSvg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -margin.left + 10)
                    .attr("x", -height / 2)
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .style("font-size", "12px")
                    .style("fill", "#64748b")
                    .text("爪 专  (%)");

                // Line generator
                const line = d3.line()
                    .x(d => xScale(d.date))
                    .y(d => yScale(d.mood));

                // Draw the line
                chartSvg.append("path")
                    .datum(dragonMoodData)
                    .attr("class", "line")
                    .attr("d", line);

                // Add circles for data points
                chartSvg.selectAll(".dot")
                    .data(dragonMoodData)
                    .enter().append("circle")
                    .attr("class", "dot")
                    .attr("cx", d => xScale(d.date))
                    .attr("cy", d => yScale(d.mood))
                    .attr("r", 5)
                    .on("mouseover", function(event, d) {
                        tooltip.html(`<strong>${d3.timeFormat("%Y-%m-%d %H:%M")(d.date)}</strong><br>爪 专: ${d.mood}%`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px")
                            .style("opacity", 1);
                    })
                    .on("mouseout", function() {
                        tooltip.style("opacity", 0);
                    });
            }

            // Initial draw of the mood chart
            drawDragonMoodChart();
        });
    </script>
</body>
</html>
